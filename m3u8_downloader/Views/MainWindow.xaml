<Window
    x:Class="m3u8_downloader.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="clr-namespace:m3u8_downloader.Models"
    xmlns:vm="clr-namespace:m3u8_downloader.ViewModels"
    Title="M3U8视频下载器"
    Width="720"
    Height="540"
    d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <!--  添加顶部菜单  -->
        <Menu Grid.Row="0">
            <MenuItem Header="_文件" SubmenuOpened="FileMenuItem_OnSubmenuOpened">
                <MenuItem Command="{Binding OpenFileCommand}" Header="_打开" />
                <MenuItem Command="{Binding SelectFolderCommand}" Header="_保存" />
                <Separator />
                <MenuItem Command="{Binding ExitApplicationCommand}" Header="_退出" />
            </MenuItem>
            <MenuItem Header="_帮助" SubmenuOpened="HelpMenuItem_OnSubmenuOpened">
                <MenuItem Command="{Binding ShowDocumentCommand}" Header="_使用说明" />
                <MenuItem Command="{Binding ShowAboutCommand}" Header="_关于" />
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="100" />
            </Grid.ColumnDefinitions>

            <hc:TextBox
                Grid.Column="0"
                hc:InfoElement.ShowClearButton="True"
                Text="{Binding M3U8Url}" />

            <Button
                Grid.Column="1"
                Margin="10,0,0,0"
                HorizontalAlignment="Stretch"
                Command="{Binding ParseUrlCommand}"
                Content="解析"
                Style="{StaticResource ButtonPrimary}" />
        </Grid>

        <DataGrid
            x:Name="DownloadTaskDataGrid"
            Grid.Row="2"
            Margin="10,0,10,10"
            Padding="0"
            AutoGenerateColumns="False"
            Background="White"
            GridLinesVisibility="All"
            HorizontalGridLinesBrush="{DynamicResource AppBorderBrush}"
            ItemsSource="{Binding DownloadTaskSource}"
            RowHeight="30"
            VerticalGridLinesBrush="{DynamicResource AppBorderBrush}">
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Height" Value="30" />
                    <Setter Property="HorizontalContentAlignment" Value="Center" />
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Height" Value="30" />
                    <Setter Property="Margin" Value="0" />
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="Height" Value="30" />
                    <Setter Property="BorderThickness" Value="0" />
                    <Setter Property="TextBlock.TextAlignment" Value="Center" />
                </Style>
            </DataGrid.CellStyle>

            <DataGrid.Columns>
                <DataGridTextColumn
                    Width="3*"
                    Binding="{Binding TaskName}"
                    CanUserResize="False"
                    Header="文件名">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding TotalSegments}"
                    CanUserResize="False"
                    Header="片段总数"
                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding Duration}"
                    CanUserResize="False"
                    Header="视频时长"
                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding TotalSize}"
                    CanUserResize="False"
                    Header="视频大小"
                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding PercentComplete}"
                    CanUserResize="False"
                    Header="下载进度"
                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn
                    Width="*"
                    Binding="{Binding TaskState}"
                    CanUserResize="False"
                    Header="状态"
                    IsReadOnly="True">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>

            <!--  右键菜单  -->
            <DataGrid.ContextMenu>
                <ContextMenu Width="120" HorizontalOffset="120">
                    <MenuItem
                        Command="{Binding PlayVideoCommand}"
                        CommandParameter="{Binding Path=PlacementTarget.(DataGrid.SelectedItem).(model:DownloadTask.TaskName), RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="播放" />
                    <MenuItem
                        Command="{Binding RetryTaskCommand}"
                        CommandParameter="{Binding Path=PlacementTarget.(DataGrid.SelectedItem).(model:DownloadTask.Url), RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="重试" />
                    <MenuItem
                        Command="{Binding DeleteTaskCommand}"
                        CommandParameter="{Binding Path=PlacementTarget.(DataGrid.SelectedItem).(model:DownloadTask.Url), RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                        Header="删除" />
                </ContextMenu>
            </DataGrid.ContextMenu>
        </DataGrid>
    </Grid>
</Window>
